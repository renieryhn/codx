Imports prjDatos
Imports UserControls.FormsAuth
Public Class Login
    Inherits System.Web.UI.Page
    Dim Funciones As New funciones
    Dim dtPermisos As New DataTable
    Dim Autenticacion As New LdapAuthentication
    Dim nombreDominio As String = "Seip.gob.hn"
    Dim spBitacora_Add As String = "pBitacora_Add"
    Dim sMensaje As String


#Region "Eventos"
    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        Session("Usuario") = ""
    End Sub
    Private Sub Login_PreRender(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.PreRender

    End Sub
    Private Sub Login1_Authenticate(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.AuthenticateEventArgs) Handles Login12.Authenticate
        ''autenticacion de windows
        'If Autenticacion.IsAuthenticated(nombreDominio, Login12.UserName, Login12.Password) Then
        '    e.Authenticated = True
        '    Session("Usuario") = Login12.UserName
        '    'Response.Redirect("~/Mantenimientos/Seguridad/usuario/wfmUsuario_List.aspx")
        '    Response.Redirect("~/Default.aspx")
        'Else
        '    e.Authenticated = False
        'End If
        'autenticacion en  bd...
        If Funciones.Filldatatable("pUsuario_List", dtParametros, sMensaje).Rows.Count = 0 Then
            e.Authenticated = False
        Else
            e.Authenticated = True
            Session("Usuario") = Login12.UserName
            'Funciones.Ejecutar(spBitacora_Add, dtParametrosBitacora)

            Response.Redirect("~/Default.aspx")
        End If
        If sMensaje <> "" Then
            Mensaje(sMensaje)
        End If
    End Sub
#End Region
#Region "Metodos"
    'parametros para autenticacion en bd...
    Private Function dtParametros(Optional ByVal bInactivo As Boolean = False) As DataTable
        Try
            dtParametros = Funciones.dtDatos.Clone
            dtParametros.Rows.Add("Nombre", Login12.UserName)
            dtParametros.Rows.Add("Password", Login12.Password)
            dtParametros.Rows.Add("ip", Request.ServerVariables("REMOTE_ADDR").ToString())

        Catch ex As Exception

        End Try
    End Function
    'Private Function dtParametrosBitacora(Optional ByVal bInactivo As Boolean = False) As DataTable
    '    Try
    '        dtParametrosBitacora = Funciones.dtDatos.Clone
    '        dtParametrosBitacora.Rows.Add("NombreUsuario", Login12.UserName)
    '        dtParametrosBitacora.Rows.Add("idModificacion", 0)
    '        dtParametrosBitacora.Rows.Add("idAccion", 1)
    '        dtParametrosBitacora.Rows.Add("Comentario", "Ingreso al SIMEX desde:" + Request.ServerVariables("REMOTE_ADDR").ToString)
    '        dtParametrosBitacora.Rows.Add("Justificacion", "No Necesaria")
    '    Catch ex As Exception

    '    End Try
    ' End Function
    Public Sub Mensaje(ByVal sMensaje As String)
        Dim strScript As String = "<script language=JavaScript>"
        strScript += "alert(""" & sMensaje & """);"
        strScript += "</script>"
        If (Not ClientScript.IsStartupScriptRegistered("clientScript")) Then
            ClientScript.RegisterClientScriptBlock(Me.GetType(), "clientScript", strScript)
        End If
    End Sub
#End Region
    Protected Sub btnConsultaPublica_Click(sender As Object, e As EventArgs) Handles btnConsultaPublica.Click
        Session("Usuario") = "Publico"
        Response.Redirect("~/Registro/Expediente/Publico/wfmDetExpedientePublico.aspx")
    End Sub

    Protected Sub btnVerPDF_Click(sender As Object, e As EventArgs) Handles btnVerPDF.Click
        Response.Redirect("~/Archivos/CONSTANCIA_JDI.docx")
    End Sub
End Class